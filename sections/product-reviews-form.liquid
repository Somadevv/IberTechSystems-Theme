{{ 'product-reviews.css' | asset_url | stylesheet_tag }}

<div class="product-reviews-form page-width" id="product-review-form">
  <h3>{{ section.settings.form_title | default: 'Write a Review' }}</h3>
  
  {%- form 'contact', class: 'review-form' -%}
    {%- if form.posted_successfully? -%}
      <div class="review-form__success">
        <p>{{ section.settings.success_message | default: 'Thank you for your review! It will be published after moderation.' }}</p>
      </div>
    {%- endif -%}

    {%- if form.errors -%}
      <div class="review-form__errors">
        <h4>{{ 'contact.form.error_heading' | t }}</h4>
        <ul>
          {%- for field in form.errors -%}
            <li>
              {%- if field == 'form' -%}
                {{ form.errors.messages[field] }}
              {%- else -%}
                {{ form.errors.translated_fields[field] | capitalize }} {{ form.errors.messages[field] }}
              {%- endif -%}
            </li>
          {%- endfor -%}
        </ul>
      </div>
    {%- endif -%}

    <div class="review-form__field">
      <label for="ContactFormName">{{ section.settings.name_label | default: 'Name' }} *</label>
      <input type="text" id="ContactFormName" name="contact[name]" value="{%- if form.name -%}{{ form.name }}{%- elsif customer -%}{{ customer.name }}{%- endif -%}" required>
    </div>

    <div class="review-form__field">
      <label for="ContactFormEmail">{{ section.settings.email_label | default: 'Email' }} *</label>
      <input type="email" id="ContactFormEmail" name="contact[email]" value="{%- if form.email -%}{{ form.email }}{%- elsif customer -%}{{ customer.email }}{%- endif -%}" required>
    </div>

    <div class="review-form__field">
      <label for="ContactFormRating">{{ section.settings.rating_label | default: 'Rating' }} *</label>
      <div class="rating-input">
        {%- for i in (1..5) -%}
          <input type="radio" id="star{{ i }}" name="contact[rating]" value="{{ i }}" required>
          <label for="star{{ i }}" class="star">â˜…</label>
        {%- endfor -%}
      </div>
    </div>

    <div class="review-form__field">
      <label for="ContactFormTitle">{{ section.settings.title_label | default: 'Review Title' }}</label>
      <input type="text" id="ContactFormTitle" name="contact[review_title]" value="{{ form.review_title }}" placeholder="{{ section.settings.title_placeholder | default: 'Summarize your review' }}">
    </div>

    <div class="review-form__field">
      <label for="ContactFormBody">{{ section.settings.body_label | default: 'Review' }} *</label>
      <textarea id="ContactFormBody" name="contact[body]" rows="6" required placeholder="{{ section.settings.body_placeholder | default: 'Share your experience with this product' }}">{{ form.body }}</textarea>
    </div>

    <input type="hidden" name="contact[product]" value="{{ product.title }}">
    <input type="hidden" name="contact[product_id]" value="{{ product.id }}">
    <input type="hidden" name="contact[form_type]" value="product_review">

    <div class="review-form__actions">
      <button type="submit" class="button">
        {{ section.settings.submit_text | default: 'Submit Review' }}
      </button>
    </div>
  {%- endform -%}
</div>

<script src="{{ 'product-reviews.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Product Review Form",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "form_title",
      "label": "Form Title",
      "default": "Write a Review"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success Message",
      "default": "Thank you for your review! It will be published after moderation."
    },
    {
      "type": "header",
      "content": "Form Labels"
    },
    {
      "type": "text",
      "id": "name_label",
      "label": "Name Label",
      "default": "Name"
    },
    {
      "type": "text",
      "id": "email_label",
      "label": "Email Label", 
      "default": "Email"
    },
    {
      "type": "text",
      "id": "rating_label",
      "label": "Rating Label",
      "default": "Rating"
    },
    {
      "type": "text",
      "id": "title_label",
      "label": "Review Title Label",
      "default": "Review Title"
    },
    {
      "type": "text",
      "id": "body_label",
      "label": "Review Body Label",
      "default": "Review"
    },
    {
      "type": "text",
      "id": "submit_text",
      "label": "Submit Button Text",
      "default": "Submit Review"
    },
    {
      "type": "header",
      "content": "Placeholders"
    },
    {
      "type": "text",
      "id": "title_placeholder",
      "label": "Title Placeholder",
      "default": "Summarize your review"
    },
    {
      "type": "text",
      "id": "body_placeholder",
      "label": "Body Placeholder",
      "default": "Share your experience with this product"
    }
  ],
  "presets": [
    {
      "name": "Product Review Form"
    }
  ]
}
{% endschema %}